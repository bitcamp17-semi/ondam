<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.BoardMapper">

	<!-- 전체 글 개수 -->
	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*) FROM board
	</select>

	<!-- 최대 idx -->
	<select id="getMaxIdx" resultType="int">
		SELECT MAX(idx) FROM board
	</select>

	<!-- 글쓰기 저장 (hidden 값이 있을 경우에만 포함) -->
	<insert id="insertWrite" parameterType="data.dto.BoardDto">
		INSERT INTO board (
			id, category, title, content, authorid,
			<if test="hidden != null">hidden,</if>
			createdat
		)
		VALUES (
			#{id}, #{category}, #{title}, #{content}, #{authorId},
			<if test="hidden != null">#{hidden},</if>
			NOW()
		)
	</insert>

	<!-- 페이징된 게시글 목록 -->
	<select id="getPagingList" resultType="data.dto.BoardDto">
		SELECT * FROM board
		ORDER BY idx DESC
		LIMIT #{start}, #{perpage}
	</select>

	<!-- 사용자 ID 기준 게시글 조회 -->
	<select id="getSelectById" resultType="data.dto.BoardDto">
		SELECT * FROM board
		WHERE authorid = #{myid}
	</select>

	<!-- 게시글 수정 -->
	<update id="updateBoard" parameterType="data.dto.BoardDto">
		UPDATE board
		SET title = #{title},
			content = #{content}
		WHERE idx = #{idx}
	</update>

	<!-- 게시글 삭제 -->
	<delete id="deleteBoard">
		DELETE FROM board
		WHERE idx = #{idx}
	</delete>

	<!-- 익명게시판 글 목록 조회 -->
	<select id="selectHiddenPosts" resultType="data.dto.BoardDto">
		SELECT * FROM board
		WHERE hidden = true
		ORDER BY idx DESC
	</select>

	<!-- 전체 글 목록 -->
	<select id="getAllBoards" resultType="data.dto.BoardDto">
		SELECT * FROM board
		ORDER BY id DESC
	</select>

	<!-- 카테고리별 게시글 목록 -->
	<select id="findByCategory" resultType="data.dto.BoardDto">
		SELECT * FROM board
		WHERE category = #{category}
		ORDER BY createdate DESC
	</select>

</mapper>