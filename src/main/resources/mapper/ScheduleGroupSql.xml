<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.ScheduleGroupMapper">
	<!-- 그룹 생성 -->
	<insert id="scheGroupInsert" parameterType="map"  useGeneratedKeys="true" keyProperty="id">
		insert into schedule_group (name, departmentId, ownerId, color, createdAt)
		values (#{name},#{departmentId},#{ownerId},#{color},now())
	</insert>
	
	<!-- 그룹 목록 조회(내가 그룹장이거나 그룹의 멤버인 경우 목록 조회) -->
	<select id="readAllGroup" resultType="ScheduleGroupDto">
	SELECT DISTINCT sg.*
	FROM semi.schedule_group sg
	LEFT JOIN semi.schedule_group_members sgm ON sg.id = sgm.groupId
	WHERE sg.ownerId = #{userId}
   		OR sgm.userId = #{userId}
	</select>
	
	<!-- 그룹명이 '개인일정'이고 'ownerId'가 본인 일정이 있는지 확인 -->
	<select id="readPrivateGroup" resultType="ScheduleGroupDto">
		SELECT * FROM schedule_group 
		WHERE ownerId = #{ownerId} 
  		AND name = '개인일정' 
	</select>
	
	<!-- 그룹명이 '회사일정'이고 멤버로 사용자가 있는지 확인 -->
	<select id="readCompanyGroupMember" resultType="ScheduleGroupDto">
	SELECT * FROM schedule_group g
	LEFT JOIN schedule_group_members m ON g.id = m.groupId AND m.userId = #{userId}
	WHERE g.name = '회사일정'
	</select>
	
	<!-- 그룹명이 '회사일정'인 groupId 조회 -->
	<select id="readCompanyGroupId" resultType="int">
	SELECT groupId FROM schedule_group g
	LEFT JOIN  schedule_group_members m 
    on g.id = m.groupId
    WHERE g.name='회사일정'
	limit 1
	</select>
</mapper>