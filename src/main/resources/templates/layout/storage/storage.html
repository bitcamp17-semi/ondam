<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/style/globals.css}"/>
    <link rel="stylesheet" th:href="@{/style/storage.css}"/>
    <link rel="stylesheet" th:href="@{/style/header.css}"/>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
</head>
<body>
<div class="fullbox">
    <div th:replace="~{layout/header :: header}"></div>
    <div class="main">
        <div class="nav">
            <div class="navtitle">
                ê³µìœ ë¬¸ì„œí•¨
            </div>
            <div class="navbar">
                <div id="navlist2">ë¬¸ì„œí•¨</div>
            </div>
        </div>
        <div class="section">
            <div class="leftarticle">
                <div class="orgaddbox">
                    <button class="addbtn" id="addteambtn">í´ë”ì¶”ê°€</button>
                </div>
                <div class="orgchart">
                    <ul class="tree" id="tree-root">
                        <li>
        <span class="folder" data-id="1">
            <i class="bi bi-chevron-down toggle-icon"></i> ğŸ“ ë¶€ì„œ1
        </span>
                            <ul>
                                <li>
                <span class="folder" data-id="2">
                    <i class="bi bi-chevron-right toggle-icon"></i> ğŸ“ íŒ€A
                </span>
                                    <ul>
                                        <li><span class="folder" data-id="3">ğŸ“ í•˜ìœ„í´ë”1</span></li>
                                        <li><span class="folder" data-id="4">ğŸ“ í•˜ìœ„í´ë”2</span></li>
                                    </ul>
                                </li>
                                <li><span class="folder" data-id="5">ğŸ“ íŒ€B</span></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="rightarticle">
                <div class="righttop">
                    <button id="downloadSelected" class="whitebtn">ì„ íƒ ë‹¤ìš´ë¡œë“œ</button>
                    <button id="deleteSelected" class="whitebtn">ì„ íƒ ì‚­ì œ</button>
                </div>
                <div class="rightmain">
                    <div class="listtop">
                        <input type="checkbox" class="selectAll list-cell">
                        <div class="list-cell">ë²ˆí˜¸</div>
                        <div class="list-cell listtitle">ì œëª©</div>
                        <div class="list-cell">íŒŒì¼ë¶„ë¥˜</div>
                        <div class="list-cell">ì‘ì„±ì</div>
                        <div class="list-cell">ì‘ì„±ì¼</div>
                    </div>

                </div>
        </div>
    </div>
</div>
<!-- í´ë” ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal-overlay" id="teammodal">
    <form class="modal-form" id="teammodal-form">
        <div class="modal-content" id="teammodal-content">
            <h2>íŒ€ ì¶”ê°€</h2>
            <div class="dropdown" id="modaldepartment">
                <span>ë¶€ì„œ</span>
                <button class="dropdown-btn">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</button>
                <div class="dropdown-menu">
                    <a href="#">ì˜µì…˜ 2-1</a>
                    <a href="#">ì˜µì…˜ 2-2</a>
                    <a href="#">ì˜µì…˜ 2-3</a>
                </div>
            </div>
            <div class="modalteamtitle">
                <span>íŒ€ ì´ë¦„</span>
                <input class="modaltitle" id="teammodal-title" type="text" placeholder="ì¶”ê°€í•  íŒ€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"/>
            </div>
            <div class="buttonset" id="teammodal-btnset">
                <button type="submit" class="submit-modal" id="teamsubmit">ì¶”ê°€í•˜ê¸°</button>
                <button type="button" class="close-modal" id="teamclose">ë‹«ê¸°</button>
            </div>
        </div>
    </form>
</div>
<script>
    $(document).on("change", ".selectAll", function () {
        $(".childCheckbox").prop("checked", $(this).prop("checked"));
    });

    const fileData = {
        3: [
            {
                title: "ê¸‰ì—¬ëª…ì„¸ì„œ 3ì›”",
                category: "ê¸‰ì—¬",
                writer: "í™ê¸¸ë™",
                date: "2025.03.28",
                filename: "ê¸‰ì—¬ëª…ì„¸ì„œ_3ì›”.pdf"
            },
            {
                title: "ì—…ë¬´ë³´ê³ ì„œ 1ë¶„ê¸°",
                category: "ë³´ê³ ì„œ",
                writer: "ê¹€ì² ìˆ˜",
                date: "2025.03.20",
                filename: "ì—…ë¬´ë³´ê³ ì„œ_1ë¶„ê¸°.docx"
            }
        ],
        4: [
            {
                title: "ì—°ì°¨ì‹ ì²­ì„œ",
                category: "ì¸ì‚¬",
                writer: "ì´ì˜í¬",
                date: "2025.03.15",
                filename: "ì—°ì°¨ì‹ ì²­ì„œ.xlsx"
            }
        ],
        5: [
            {
                title: "íŒ€B ê³„íšì„œ",
                category: "ê¸°íš",
                writer: "ë°•ë¯¼ìˆ˜",
                date: "2025.02.10",
                filename: "íŒ€B_ê³„íšì„œ.pptx"
            }
        ]
    };

    $(document).ready(function () {
        const $firstLi = $("#tree-root > li");

        // ì²˜ìŒ ë¶€ì„œ1ì€ ì—´ë ¤ ìˆê²Œ
        $firstLi.addClass("open");
        $firstLi.children("ul").show();

        // ì•„ì´ì½˜ ë°”ê¿”ì¤Œ
        $firstLi.find("> .folder > .toggle-icon")
            .removeClass("bi-chevron-right")
            .addClass("bi-chevron-down");
    });

    // íŠ¸ë¦¬ í´ë” í´ë¦­ ì´ë²¤íŠ¸
    $(document).on("click", ".folder", function (e) {
        e.stopPropagation();

        const $li = $(this).closest("li");
        const $childUl = $li.children("ul");
        const $icon = $(this).find(".toggle-icon");

        if ($childUl.length > 0) {
            if ($li.hasClass("open")) {
                $childUl.slideUp(200, () => {
                    $li.removeClass("open");
                    $icon.removeClass("bi-chevron-down").addClass("bi-chevron-right");
                });
            } else {
                $childUl.slideDown(200, () => {
                    $li.addClass("open");
                    $icon.removeClass("bi-chevron-right").addClass("bi-chevron-down");
                });
            }
        } else {
            const folderId = $(this).data("id");
            const files = fileData[folderId] || [];

            let html = "";
            if (files.length > 0) {
                html += `
                <div class="listtop">
                    <input type="checkbox" class="selectAll list-cell">
                    <div class="list-cell">ë²ˆí˜¸</div>
                    <div class="list-cell listtitle">ì œëª©</div>
                    <div class="list-cell">íŒŒì¼ë¶„ë¥˜</div>
                    <div class="list-cell">ì‘ì„±ì</div>
                    <div class="list-cell">ì‘ì„±ì¼</div>
                </div>
                <div class="listmain">
            `;
                files.forEach((file, index) => {
                    html += `
                    <div class="listcontent">
                        <input type="checkbox" class="childCheckbox list-cell">
                        <div class="list-cell">${index + 1}</div>
                        <div class="list-cell listtitle" data-filename="${file.filename}">${file.title}</div>
                        <div class="list-cell">${file.category}</div>
                        <div class="list-cell">${file.writer}</div>
                        <div class="list-cell">${file.date}</div>
                    </div>
                `;
                });
                html += `</div>`;
            } else {
                html = "<p>í•´ë‹¹ í´ë”ì— íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            }

            $(".rightmain").html(html);
        }
    });

    // í´ë” DOM ìƒì„± í•¨ìˆ˜
    function createFolderElement(name, id, children = []) {
        const hasChildren = children.length > 0;
        const $li = $("<li>");

        const $folderSpan = $("<span>").addClass("folder").attr("data-id", id);

        if (hasChildren) {
            $folderSpan.append(`<i class="bi bi-chevron-right toggle-icon"></i>`);
        }

        $folderSpan.append(`ğŸ“ ${name}`);
        $li.append($folderSpan);

        if (hasChildren) {
            const $ul = $("<ul>");
            children.forEach(child => {
                $ul.append(createFolderElement(child.name, child.id, child.children || []));
            });
            $li.append($ul);
        }

        return $li;
    }

    // í´ë” ì¶”ê°€ ë²„íŠ¼
    let folderIdCounter = 100;
    $("#addteambtn").on("click", function () {
        const newId = folderIdCounter++;
        const folderName = prompt("ì¶”ê°€í•  í´ë”ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:");
        if (!folderName) return;

        const $newFolder = createFolderElement(folderName, newId);
        $("#tree-root").append($newFolder);
    });

    // ì œëª© í´ë¦­ ì‹œ ë‹¤ìš´ë¡œë“œ
    $(document).on("click", ".listtitle", function () {
        const filename = $(this).data("filename");
        if (!filename) return;
        window.location.href = `/download?filename=${encodeURIComponent(filename)}`;
    });

    //ì„ íƒ í•­ëª© ë‹¤ìš´ë¡œë“œ/ì‚­ì œ
    function getSelectedFiles() {
        const selected = [];
        $(".childCheckbox:checked").each(function () {
            const filename = $(this).closest(".listcontent").find(".listtitle").data("filename");
            if (filename) selected.push(filename);
        });
        return selected;
    }

    $("#downloadSelected").on("click", function () {
        const files = getSelectedFiles();
        if (files.length === 0) return alert("ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

        files.forEach(file => {
            window.open(`/download?filename=${encodeURIComponent(file)}`);
        });
    });

    $("#deleteSelected").on("click", function () {
        const files = getSelectedFiles();
        if (files.length === 0) return alert("ì‚­ì œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

        if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            // ì—¬ê¸°ì— Ajaxë¡œ ì‚­ì œ ìš”ì²­ ë³´ë‚´ëŠ” ì½”ë“œ ì‘ì„± ê°€ëŠ¥
            console.log("ì‚­ì œí•  íŒŒì¼ë“¤:", files);
        }
    });
</script>
</div>
</body>
</html>