<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>전자결재 템플릿 편집기</title>

    <!-- Quill 에디터 CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Quill 에디터 JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <style>
        #editor-container {
            height: 400px;
            margin-top: 10px;
        }
        #controls {
            margin-bottom: 10px;
        }
        input, select, button {
            margin-right: 10px;
        }
    </style>
</head>
<body>

<h2>전자결재 템플릿 편집기</h2>

<div id="controls">
    <!-- 템플릿 저장 -->
    <input type="text" id="template-title" placeholder="템플릿 제목" />
    <button id="save-template">템플릿 저장</button>

    <!-- 템플릿 불러오기 -->
    <select id="template-list">
        <option disabled selected>템플릿 선택</option>
    </select>
</div>

<!-- Quill 에디터 -->
<div id="editor-container"></div>

<script>
    // 1. Quill 에디터 초기화
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: '내용을 입력하세요...',
        modules: {
            toolbar: [
                [{ header: [1, 2, false] }],
                ['bold', 'italic', 'underline'],
                ['image', 'code-block']
            ]
        }
    });

    // 2. 템플릿 저장
    $('#save-template').on('click', function () {
        const title = $('#template-title').val();
        const content = quill.root.innerHTML;

        if (!title.trim()) {
            alert('템플릿 제목을 입력하세요!');
            return;
        }

        $.ajax({
            url: '/template/save', // 서버에 맞게 URL 조정
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ title: title, content: content }),
            success: function () {
                alert('템플릿이 저장되었습니다!');
                loadTemplateList(); // 저장 후 목록 갱신
            },
            error: function () {
                alert('템플릿 저장 실패');
            }
        });
    });

    // 3. 템플릿 목록 불러오기
    function loadTemplateList() {
        $.ajax({
            url: '/template/list',
            method: 'GET',
            success: function (templates) {
                $('#template-list').empty().append('<option disabled selected>템플릿 선택</option>');
                templates.forEach(function (template) {
                    $('#template-list').append(
                        $('<option>', { value: template.id, text: template.title })
                    );
                });
            }
        });
    }

    // 4. 템플릿 선택 시 내용 불러오기
    $('#template-list').on('change', function () {
        const id = $(this).val();

        $.ajax({
            url: '/template/load/' + id,
            method: 'GET',
            success: function (data) {
                quill.root.innerHTML = data.content;
            },
            error: function () {
                alert('템플릿 불러오기 실패');
            }
        });
    });

    // 5. 페이지 로딩 시 템플릿 목록 자동 불러오기
    $(document).ready(function () {
        loadTemplateList();
    });
</script>

<h2>결재 문서 보기</h2>

<!-- 내용 출력 -->
<div id="readonly-content" style="border:1px solid #ccc; padding:20px;">
    <!-- 여기에 내용 들어감 -->
</div>

<!-- 결재선 -->
<h3 style="margin-top:30px;">결재선</h3>
<table border="1" cellpadding="10" style="width:100%; text-align:center;">
    <thead>
    <tr>
        <th>기안자</th>
        <th>팀장</th>
        <th>부서장</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>홍길동 (결재완료)</td>
        <td>김팀장 (대기)</td>
        <td>이부장 (대기)</td>
    </tr>
    </tbody>
</table>

<!-- 결재 / 반려 버튼 -->
<div style="margin-top:20px;">
    <button id="approve-btn">결재</button>
    <button id="reject-btn">반려</button>
</div>

<script>
    // 저장된 HTML 콘텐츠 가져오기 (예시)
    const savedHtml = `<h1>출장 신청서</h1><p>일자: 4월 10일 ~ 4월 12일</p><p>장소: 부산</p>`;

    // 읽기 전용 영역에 출력
    document.getElementById('readonly-content').innerHTML = savedHtml;

    // 버튼 동작
    $('#approve-btn').on('click', () => {
        alert('결재되었습니다!');
        // 여기에 AJAX로 결재 상태 전송
    });

    $('#reject-btn').on('click', () => {
        alert('반려 처리되었습니다.');
        // 여기에 AJAX로 반려 상태 전송
    });
</script>
</body>
</html>